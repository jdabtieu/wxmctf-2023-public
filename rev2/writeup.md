# Natural Selection - WxMCTF 2023
![](https://img.shields.io/badge/category-rev-blue) ![](https://img.shields.io/badge/author-jdabtieu-orange)

## Description
The great tech giant, err, I mean scientist Darwin came up with the theory of natural selection in the 18th (19th?) century. Since MGCI students are so much better than WLMAC students, surely WLMAC will extinct themselves - I mean cease to exist eventually as natural selection takes over. Now, which operating system was Darwin again?

[main.py](dist/main.py)

## Solution
Upon opening the file, there are some imports, and the a massive string inside `exec(b64decode(...))`. The mix of uppercase and lowercase letters, and numbers, and the two equal signs at the end scream [base64](https://developer.mozilla.org/en-US/docs/Glossary/Base64), if the function name didn't already give it away. Essentially, the program is just running another encoded program, inside it. We can take the base64 string and throw it into an [online decoder](https://www.base64decode.org/) to get to the next stage.
```py
import base64

b = int(input("base ? decode? "))

exec(getattr(base64, f"b{b}decode")("MV4GKYZIMI3DIZDFMNXWIZJIEJNG4STWMJJUEMDBK4YWYSKHNR2GGRZZPFSEGQT2MJDVM3DDIFYG2YSDIE4USR3MOVRUQVRQJNBUUWDBI5DDASKHKJ3ESSDMOZSFGQRQMFDWY5LBPFBDAYKHKVTVU3LYNBNHSQTQMN5DSY3CNFEXAQ3OJZZVUV2WO5FUIQLVJZBWWS3DJBFHAYTOKFXUS23IORRFGSLQINXE4422K5LHOS2EIV2U42LLJNRUQSTQMJXFC32JNNVWOZCHNBYGE3LTM5SVOOJRJIZUU3CJJBSHSYRSGVXEYQ2CNFSFQULHMJDVMMCKGNGWOZCIJI2USR2GOVSVQZDIMVME22KLKFYGYZKHKZVEWR2JGJHEOUTMLEZDS222KNTWSWKWMN4GIMSJPJJWUQSKKNDEU52ZNRSFMUZSJZEVG3SCNFRGYRTWKNLXINDENRWFQVLOIJUWEV2OOBKEKTSDMJDUU5CVKRWEUYKVNR5FGVLEMFRTEUSZKRWTSUKWNRFDKWSGMRLGGRKOORLW4WTKMFKUU52TKVSHGZCVNREVG3LINFRFOUTTKMYFEVTDIU4W4YRSMRFFGRSKO5MWYZCWMRLU26LFI54GCV2FIZ3FIV3MOZRVORSUMEYHISSRGBFDGWJSGFZWIV2SIRNDE3CNMFKWY6STKVSFOZCWOBCU2R3MJJQVQZDOK5WTCNCNK5GXSWT2NRLVGRLPPBLWYTTSKMZFESDCJBJGCVL2KY3FS23EK5REOTSELJ5EMTCVLBBDGWJSGFZWIV2SIRNDE3CTKJ5GYMKXNRHEMYKVORJGGSDENJRFO6BRLJCU43TBKZFHIZKHNBQU2RJVOZLWYZCPMNWHAWKTK5SGWYLLKYYVIVKNGBGVK6CZKRWXQWSNGFNDKV3MJZFGGRKOOVIW43DIKZ5FK52TGBHEWYKXKZKFC22WLJLUK332LFLGGMDBKV2FEY2HPBWFEMK2OFJTAZCKJVVTKSCVNV4FUTLKNRZFO3CONZQVM3CXLJDHAYKNI54DCV3LNBBWCV2GKZREONK2KZWU252XNJFE6U2HKZEGCR3UKNGVQQLZK5KES53EGA2XEVDOIJJFMMSSOFKTAVTXMQYWY5COKZFGSTKHPB5FS23IMFQTCVLXKNXEMWCWNVGXOWLNGFJVERSGOVREO5CXMVWEU5KXNNLGWYRSJZEFI2SWKJRGY4DQLFLFMS2XKZWFOWL2IZUE223MGZLWW2DXKNWFK52TNRNFUTLKKZ4VO2SGKNLUMSTUMNDFMTSWKRDHKV2WLJVE2V2WORKWW2CXMJLWQ2CVKRBHGZBRIV4U2VTENJGWWWSZKYYWI22TNVFFOU3NHFNE22SWOJMTAZCLMNDE4WC2I5UFOZLMJJ2VOVCCNNHEORSIKVVWQWDCNRYHCWLMKJBE23CFPFREKSTBJVVTKSSVGI2UGYKXJJZVE3S2KRLDG2D2LJDTCU2WIZDHIY2GOBLWK3CKGFLWWVSPKEZFMWCVNRUE6URSKJZFK2SKN5SDC232MJCU423CKVYHOVKXOMYVO3CZO5HFMRSXK5DXQR2XNJDGCU2WJZYVM23QKNLUO2BTK5LTAMKWGA2UMYSFNBUVGRS2OFKFIRSLMMYWIV22IZFGQVSYKJJVSMDEGRQVMSLZMVEFEVCWKU2UYWL2JJDVORJVKVJG26CSJVDXQ5KXKZNGUTKGN54VI23INRJDE2DSKVVEM52NNRVXSTKIMRHWCMBVO5KVMZDLMFWE4RTDJBSFUYSUKZJVS2SCONRTESSJK5WXIVSNIVYHQVRRLJVE2R2KORKWWUSSMJWXQ4SWNZYFGYTMOBDFURZZNJJDANBRKVLTKYLBK5DFMU3LGVNFM3KNPBKFMZCXKJDEUWC2IZSFIUSXHB4FKMKWMFQTETSIKNXFEVTCNRYHEVCUIF4GE3DMK5MXURTMMJLEUSKWNUYW6WKWIV3WESDEKJGWURSYLF5EUTTFKZNFKV3LKJUFMVK2OVLVIQTPKMZE4SCTNZLFMVT2NRFVS23EGRGWY4CHKRVU42DCI54FSVDLMMYWCMKFO5JWUVTBKJWU252XNJFFGU2HIZEVC3LQNRLFK33ZK5LTC42RGJJHGYSIKZKWEWCCOJLDAVTXMMYU4VTBIVHGUTKXPBNFMVZQPBQVKMDXMNCEEWSNGJ4EOV3KIZQVGVSOOFLGW4CTJVXGQUSWNRUHGUJSJZEFG3SWKVQWWSTIKZVEEYLDNRHFQYSIJJKE2WCCLJMVK2CDMEYUK6K2IRHFITKVLIZVS23EK5JUMWTUMNCXQU2NI52DKVSHORVVKMSKI5QTG3CQKYZVE2CWKRFGWY2GMRKVC3JZKRGWWNKJKUZDKV2WNRNDMYSFORNGCMLQJRNEO6DLKYZEMR2TNVWGSVSUKF4FMVS2NJHFORLYKNVFU2CNGJJFSVTNGFJE2RTMGZJWYZCXKIYFMNKXNNSHGYKWLJEGIRCOKZGVMWTWKZKEUSTFI5HEOVLMJJUVMRK2O5LFO4CDLFLVEV2UNRSFKYJTIJUFIV3UMFLVMWLYLJDXI2CSNRXTEVTNOBHVSVSKORQUMTS2MFVUS52WNNNEOVSXJJDVE3C2JZJFM4BTKYZHIU2UGJEXSVLLMRUE2M2CK5MWYUSHMMYXAWDDPJBE4UTMJJLFKMTTGVMVOSSWJVKFMWDBNM2TGWKWMRDWGMKOOFJGYVSXMJLEU6CWIZLGWUZSJZLVO3SGNFJFQQTPKZWFM53FNRSFQZCHHFKU223QI5MWWVSTKZDUUR2XNU4VMYLLJJQVURCGJ5RVMUTSJZLUMTTBGNAXOVSEIZJVCMKOONKGWZCUMJWHAWKZNNKTCUSGNRZVURLUKRJGW4BQKRWFM53BIZMXUVCUKZKFMMTYPFMTATSKMNCXIUSQKQYGSS2TNM6SEKJJEA======"))
```

This time, the code looks a bit more complicated. We have to enter a number, and then the exec/b64decode happens again, but:

1. This is actually base32. We can tell by the fact that while it looks like base64, it does not contain lowercase letters.
2. We use some Python magic to call the b32decode function instead. After realizing that the string is base32 and entering it as input, `getattr(base64, f"b{b}decode")(...)` is equal to `getattr(base64, "b32decode")(...)`, which is equal to `base64.b32decode(...)`.

Doing a base32decode of this gives us a base64 string to decode again, and after decoding that, we get some code again.

```py
from time import sleep
fl = input("What do you think the flag is?\n")
sleep(0.4)
print("Hmm")
sleep(1.6)
print("I think you're wrong, but let's try anyways")
exec(b64decode("aW1wb3J0IHRpbWUKcHJpbnQoIkxvYWRpbmciLCBlbmQ9IiIsIGZsdXNoPVRydWUpCmZvciBpIGluIHJhbmdlKDUpOgogIHRpbWUuc2xlZXAoMioqaSkKICBwcmludCgiLiIsIGVuZD0iIiwgZmx1c2g9VHJ1ZSkKdGltZS5zbGVlcCg1KQpwcmludCgiRG9uZSEiKQpwcmludCgiRmxhZ0NoZWNrZXIgdjEuMC41LXNlY3VyZSIpCnByaW50KCJieSBEYXJ3aW4iKQpleGVjKGI2NGRlY29kZSgiYVdZZ0luZHBiaUlnYVc0Z2NHeGhkR1p2Y20wNkNpQWdjSEpwYm5Rb0lsbHZkU0JqWVc0bmRDQnlkVzRnZEdocGN5QnZiaUJYYVc1a2IzZHpJU0JVY25rZ1RXRmpUMU1nYVc1emRHVmhaQ0lwQ21Wc2FXWWdJbVJoY25kcGJpSWdhVzRnY0d4aGRHWnZjbTA2Q2lBZ2NISnBiblFvSWxsdmRTQmpZVzRuZENCeWRXNGdkR2hwY3lCdmJpQk5ZV05QVXlFZ1ZISjVJRXhwYm5WNElHbHVjM1JsWVdRaUtRcGxiR2xtSUNKc2FXNTFlQ0lnYVc0Z2NHeGhkR1p2Y20wNkNpQWdjSEpwYm5Rb0lsbHZkU0JqWVc0bmRDQnlkVzRnZEdocGN5QnZiaUJNYVc1MWVDRWdWSEo1SUZkcGJtUnZkM01nYVc1emRHVmhaQ0lwQ21Wc2MyVTZDaUFnY0hKcGJuUW9JbGx2ZFNCallXNG5kQ0J5ZFc0Z2RHaHBjeUJ2YmlCdlluTmpkWEpsSUhCc1lYUm1iM0p0Y3lFZ1ZISjVJR2xQVXlCcGJuTjBaV0ZrSWlrS1pYaHBkQ2d3S1FwbGVHVmpLR0kyTkdSbFkyOWtaU2dpWTBoS2NHSnVVVzlKYkZKdldWaFJibU41UVc5a1J6a3dXVmQ0YzJWVGEyZGliVGt3U1VoU2IxcFRRbTFpUjBadVNWTkpaMkZYV1dkaFZ6VjNaRmhSYjB0VFFUbFFVMEZwWkROb2RGa3pVbTFsZWs0MFRUSk9abU15WjNwaWFsSjFUVmRqTUdKcVZqbEphVUpzWWtoT2JFbERTbFZoUjBZd1NqTk5aMkp0T1RCSlNGSnZXbE5DYldKSFJtNUphV3M5SWlrcCIpKQ=="))
```

It asks what we think the flag is, pretends to think a bit by pausing for 0.4s and 1.6s, and just tells us that we're wrong without even checking! We can ignore that and continue decoding the next base64 string.

```py
import time
print("Loading", end="", flush=True)
for i in range(5):
  time.sleep(2**i)
  print(".", end="", flush=True)
time.sleep(5)
print("Done!")
print("FlagChecker v1.0.5-secure")
print("by Darwin")
exec(b64decode("aWYgIndpbiIgaW4gcGxhdGZvcm06CiAgcHJpbnQoIllvdSBjYW4ndCBydW4gdGhpcyBvbiBXaW5kb3dzISBUcnkgTWFjT1MgaW5zdGVhZCIpCmVsaWYgImRhcndpbiIgaW4gcGxhdGZvcm06CiAgcHJpbnQoIllvdSBjYW4ndCBydW4gdGhpcyBvbiBNYWNPUyEgVHJ5IExpbnV4IGluc3RlYWQiKQplbGlmICJsaW51eCIgaW4gcGxhdGZvcm06CiAgcHJpbnQoIllvdSBjYW4ndCBydW4gdGhpcyBvbiBMaW51eCEgVHJ5IFdpbmRvd3MgaW5zdGVhZCIpCmVsc2U6CiAgcHJpbnQoIllvdSBjYW4ndCBydW4gdGhpcyBvbiBvYnNjdXJlIHBsYXRmb3JtcyEgVHJ5IGlPUyBpbnN0ZWFkIikKZXhpdCgwKQpleGVjKGI2NGRlY29kZSgiY0hKcGJuUW9JbFJvWVhRbmN5QW9kRzkwWVd4c2VTa2dibTkwSUhSb1pTQm1iR0ZuSVNJZ2FXWWdhVzV3ZFhRb0tTQTlQU0FpZDNodFkzUm1lek40TTJOZmMyZ3pialJ1TVdjMGJqVjlJaUJsYkhObElDSlVhR0YwSjNNZ2JtOTBJSFJvWlNCbWJHRm5JaWs9Iikp"))
```

This once again does nothing important, and just pretends to load things, prints a message, and continues with the next base64 string.

```py
if "win" in platform:
  print("You can't run this on Windows! Try MacOS instead")
elif "darwin" in platform:
  print("You can't run this on MacOS! Try Linux instead")
elif "linux" in platform:
  print("You can't run this on Linux! Try Windows instead")
else:
  print("You can't run this on obscure platforms! Try iOS instead")
exit(0)
exec(b64decode("cHJpbnQoIlRoYXQncyAodG90YWxseSkgbm90IHRoZSBmbGFnISIgaWYgaW5wdXQoKSA9PSAid3htY3RmezN4M2Nfc2gzbjRuMWc0bjV9IiBlbHNlICJUaGF0J3Mgbm90IHRoZSBmbGFnIik="))
```

Here we see our first actual comparisons. If the user is running Windows, it tells them to run MacOS. And MacOS leads to Linux. And Linux leads to Windows. And other platforms lead to iOS (which can't even run Python natively). Regardless of the platform, the program normally terminates here (`exit(0)`) but we can continue going down the base64 rabbit hole.

```py
print("That's (totally) not the flag!" if input() == "wxmctf{3x3c_sh3n4n1g4n5}" else "That's not the flag")
```

And here's where the actual flag check takes place!

Flag: `wxmctf{3x3c_sh3n4n1g4n5}`
